# BVR GLM-AED

Code for recreating GLM-AED analyses and figures in Beaverdam Reservoir from 2015-2022

# Repo structure

This repository contains 9 main folders: 1) analysis contains the summarized water quality, zooplankton, and phytoplankton output from the model, as well as R scripts needed to recreate all analyses and figures, 2) calibration contains .csv files that are contain the parameters and associated ranges in each module that are used to perform the sensitivity analysis, 3) field_data contains both the raw and cleaned .csv files for different water quality variables that are simulated, 4) glm.app contains the files and executables necessary to run the model on a local computer (Mac only), 5) inputs contains R scripts for interpolating bathymetry data and creating an inflow file, an .Rmd file for creating a daily water level .csv file used in the `InflowPreparation.R`, and associated .csv files necessary to run these scripts, 6) modeling contains all of the scripts that were used for running GLM-AED, performing sensitivity analyses, calibration, validation, and visualizing preliminary model output, 7) results contain .csv files and figures summarizing calibration results for each module, 8) sensitivity contains .csv files for only the sensitive parameters and their ranges that were identified following the sensitivity analysis for each module, and 9) sims contains the configuration files for the spin-up period vs. non-spin-up period for each of the climate warming scenarios (baseline, plus1, plus5, and plus10).

# Instructions to reproduce figures and analyses

1.  Run `01_bvr_glm_ms_figs.R` to visualize modeled vs. observed water quality variables at the surface (Fig. 1) and bottom (Fig. S4) of Beaverdam Reservoir, boxplots of water quality variables for baseline and warming temperature scenarios in the surface (Fig. 3), and bottom waters (Fig. S5).
2.  Run `02_zoop_scenarios.R` to visualize modeled zooplankton density for cladocerans, copepods, and rotifers from 2015-2022 (Fig. 2), zooplankton taxon biomass for baseline conditions vs. the plus5 scenario (Fig. 5), stacked annual zooplankton biomass bar plot (Fig. S6), smoothed monthly zooplankton biomass for each scenario (Fig. 6) and across each year (Fig. S14), boxplots of mean zooplankton biomass for each scenario and taxon (Fig. 4), lineplots of mean annual zooplankton biomass for each scenario (Fig. S8), lineplots of mean zooplankton diagnostic rates and area plot of phytoplankton relative biomass for each taxon in baseline conditions vs. the plus5 scenario (Fig. 8), lineplots of mean annual phytoplankton biomass for each scenario and taxon (Fig. S12), phytoplankton raw biomass for each scenario from 2015-2022 (Fig. S9), mean day of year corresponding to the maximum zooplankton biomass for each taxon and scenario (Fig. 7), and lineplots summarizing the change in zooplankton and phytoplankton monthly biomass across scenarios (Fig. S15). Additionally, this script runs the Kruskal-Wallis tests across scenarios for each taxon for magnitude and biomass, as well as the associated post-hoc analyses for these tests.
3.  Run `03_GOF_tables.R` to generate goodness-of-fit tables for water quality variables aggregated across the full water column (Table S2), only for the surface (Table 1), and for zooplankton taxa aggregated across the full water column (Table S5).
4.  Run `04_zoop_par_sensitivity.R` to run the 10% parameter sensitivity for several zooplankton parameters that differ among taxa and generate supplemental figures S2, S10, and S11.
5.  Run `05_temperature_sensitivity.R` to plot the grazing temperature sensitivity function and exponential respiration and mortality function for all zooplankton taxa (Fig. S13).
6.  Run code from lines 34-78 in `run_glm_scenarios.R` to plot surface water temperature over the simulation period from 2015-2022 (Figure S7).
7.  Run code from lines 517-684 in `field_data/FieldDataPrep.R` to generate size and biomass distributions for all zooplankton taxa (FIgure S1).

Note that there were several other scripts used to create files used in this analysis (e.g., `plankton_aggregations.R`, `zoop_taxa_diagnostics.R`, `plankton_diagnostics.R`). Additional code is provided to visualize limiting variables for each of the three phytoplankton taxa across scenarios (`phyto_limiting_vars.R`), calculate summary stats for MACA climate models (`maca_rcp_temp.R`), and create glm nml files and meteorological files necessary to run a 15-year spin-up period in the model and visualize output across scenarios (`spin-up.R`). These scripts do not need to be run to recreate manuscript figures or analyses, but are provided for reference as needed.
