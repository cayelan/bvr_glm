# BVR GLM-AED

Files for the GLM-AED (General Lake Model - Aquatic EcoDynamics) model configured for Beaverdam Reservoir, Vinton, Virginia, USA from 2015-2022 that accompany the analysis by Wander et al. "Warming air temperatures alter the timing and magnitude of reservoir zooplankton biomass." This repository includes the configuration files, driver datasets, and calibrated parameter files of the GLM-AED water quality model as well as the code used to generate the figures in the manuscript. 

# Repository structure

This repository contains 9 main folders: 1) "/ analysis" contains the summarized water quality, zooplankton, and phytoplankton output from the GLM-AED model, as well as R scripts needed to recreate all manuscript analyses and figures, 2) "/calibration" contains .csv files, parameters, and associated ranges in each module that are used to perform the sensitivity analysis, 3) "/field_data" contains both the raw and cleaned .csv files for different water quality variables that are simulated for the reservoir, 4) "/glm.app" contains the files and executables necessary to run the model on a local computer (the Mac version of the model is supported only), 5) "/inputs" contains: a) R scripts for interpolating reservoir bathymetry data that are needed to create inflow driver files, b) an .Rmd file for creating a daily water level .csv file used in the `InflowPreparation.R`, and c) associated .csv files necessary to run these scripts, 6) "/modeling" contains all of the scripts that were used for running GLM-AED, performing sensitivity analyses, calibration, validation, and visualizing preliminary model output, 7) "/results" contain .csv files and figures summarizing calibration results for each module, 8) "/sensitivity" contains .csv files for the sensitive parameters and their ranges that were identified following the sensitivity analysis for each module, and 9) "/sims" contains the configuration files for the spin-up period vs. non-spin-up period for each of the climate warming scenarios (baseline, plus1, plus5, and plus10).

# Instructions to reproduce figures and analyses

Most scripts that are needed to reproduce figures and analyses are located in the `analysis`folder, except for step 8 below, which requires running part of a script in the `field_data` folder.

1.  Run `01_bvr_glm_ms_figs.R` to visualize modeled vs. observed water quality variables at the surface (Fig. 2) and bottom (Fig. S4) of Beaverdam Reservoir, boxplots of water quality variables for baseline and warming temperature scenarios in the surface (Fig. 4), and bottom waters (Fig. S5).
2.  Run `02_zoop_scenarios.R` to visualize modeled zooplankton density for cladocerans, copepods, and rotifers from 2015-2022 (Fig. 3), zooplankton taxon biomass for baseline conditions vs. the plus5 scenario (Fig. 6), stacked annual zooplankton biomass bar plot (Fig. S6), smoothed monthly zooplankton biomass for each scenario (Fig. 7) and across each year (Fig. S14), boxplots of mean zooplankton biomass for each scenario and taxon (Fig. 5), lineplots of mean annual zooplankton biomass for each scenario (Fig. S8), lineplots of mean zooplankton diagnostic rates and area plot of phytoplankton relative biomass for each taxon in baseline conditions vs. the plus5 scenario (Fig. 9), lineplots of mean annual phytoplankton biomass for each scenario and taxon (Fig. S12), phytoplankton raw biomass for each scenario from 2015-2022 (Fig. S9), mean day of year corresponding to the maximum zooplankton biomass for each taxon and scenario (Fig. 8), and lineplots summarizing the change in zooplankton and phytoplankton monthly biomass across scenarios (Fig. S15). Additionally, this script runs the Kruskal-Wallis tests across scenarios for each taxon for magnitude and biomass, as well as the associated post-hoc analyses for these tests.
3.  Run `03_GOF_tables.R` to generate goodness-of-fit tables for water quality variables aggregated across the full water column (Table S2), only for the surface (Table 1), and for zooplankton taxa aggregated across the full water column (Table S5).
4.  Run `04_zoop_par_sensitivity.R` to run the 10% parameter sensitivity for several zooplankton parameters that differ among taxa and generate supplemental figures S2, S10, and S11.
5.  Run `05_temperature_sensitivity.R` to plot the grazing temperature sensitivity function and exponential respiration and mortality function for all zooplankton taxa (Fig. S13).
6.  Run `06_maca_rcp_temp.R` to generate a table that summarizes the mean difference in air temperature between historical mean temperatures vs. RCP 4.5 and 8.5 projected temperatures (Table S4).
7.  Run code from lines 34-78 in `run_glm_scenarios.R` to plot surface water temperature over the simulation period from 2015-2022 (Fig. S7) and lines 121-234 to plot stratification duration for each scenario (Fig. S3).
8.  Run code from lines 517-684 in `field_data/FieldDataPrep.R` to generate size and biomass distributions for all zooplankton taxa (Fig. S1).

Note that there were several other scripts used to create files used in this analysis (e.g., `plankton_aggregations.R`, `zoop_taxa_diagnostics.R`, `plankton_diagnostics.R`). Additional code is provided to visualize limiting variables for each of the three phytoplankton taxa across scenarios (`phyto_limiting_vars.R`) and create glm nml files and meteorological files necessary to run a 15-year spin-up period in the model and visualize output across scenarios (`spin-up.R`). These scripts do not need to be run to recreate manuscript figures or analyses, but are provided for reference as needed.
